---
# Backend Test List: {機能名}

**Feature**: {対応するGherkin機能の参照}  
**Plan**: `docs/plans/{feature_id}/`

## Test List (テストリスト)

* {対象となるクラス・コンポーネント名}
  * {API名 / メソッド}は{何をする機能か}
    * {具体的なテストケース（正常系）}
      * {さらに具体的な入力と期待結果の例}
    * {具体的なテストケース（異常系・境界値）}
      * {さらに具体的な入力と期待結果の例}
  * {別のAPI名 / メソッド}は{何をする機能か}
    * {具体的なテストケース}
      * {さらに具体的な入力と期待結果の例}

---

**記入例 (写真保存機能の場合):**
```
* Photo API
  * [ ] 保存APIは画像を受け取り永続化する
    * [ ] 有効な画像を受け取ると201を返す（メタデータを含む）
      * [ ] sample-001.jpgを受け取ると201を返す
    * [ ] ファイルが永続化される
      * [ ] sample-001.jpgを受け取るとuploaded_files/sample-001.jpgに保存される
    * [ ] メタデータが永続化される
      * [ ] sample-001.jpgを受け取るとPhotoテーブルにレコードが追加される
  * [ ] 保存APIは無効なリクエストを拒否する
    * [ ] ファイル未指定の場合は400を返す
    * [ ] サイズ制限超過の場合は413を返す
    * [ ] 非対応フォーマットの場合は415を返す
    * [ ] 空ファイルの場合は400を返す
  * [ ] 取得APIは画像メタデータを返す
    * [ ] 存在するIDで200を返す
    * [ ] 存在しないIDで404を返す
  * [ ] 永続化の整合性
    * [ ] ファイルとメタデータは一貫して保存される（片方だけが残らない）
```

**構造化のポイント:**
- 第1階層: テストクラス名（例: `Photo API` → `PhotoApiTest.java`）
- 第2階層: `@Nested`クラス名として使用（例: `保存APIは画像を受け取り永続化する` → `@Nested class 保存APIは画像を受け取り永続化する`）
- 第3階層: `@Nested`クラス名または`@Test`メソッド名として使用（例: `有効な画像を受け取ると201を返す（メタデータを含む）`）
- 第4階層: `@Test`メソッド名として使用（例: `sample-001.jpgを受け取ると201を返す` → `@Test void sample001jpgを受け取ると201を返す()`）
  - この階層がテストメソッドに直接対応
  - 入力ファイル名（例: `sample-001.jpg`）
  - 保存先パス（例: `uploaded_files/sample-001.jpg`）
  - 期待されるHTTPステータスコード
  - データベースへの影響（例: `Photoテーブルにレコードが追加される`）
- チェックボックスは使用せず、純粋な箇条書きとする
- **重要**: 第2階層以降の文言は、そのままクラス名やメソッド名として使えるよう日本語で記述する
- テストコードの階層構造がテストリストと一致するため、可読性と保守性が向上する

**テストコードへの対応例:**

上記のテストリストは以下のようなJUnitテストコードに対応します：

```java
class PhotoApiTest {  // 第1階層: テストクラス名
    @Nested
    class 保存APIは画像を受け取り永続化する {  // 第2階層: @Nested クラス
        @Nested
        class 有効な画像を受け取ると201を返す_メタデータを含む {  // 第3階層: @Nested クラス
            @Test
            void sample001jpgを受け取ると201を返す() {  // 第4階層: @Test メソッド
                // テスト実装
            }
        }
        
        @Nested
        class ファイルが永続化される {  // 第3階層: @Nested クラス
            
            @Test
            void sample001jpgを受け取るとuploaded_files_sample001jpgに保存される() {  // 第4階層: @Test メソッド
                // テスト実装
            }
        }
    }
    
    @Nested
    class 保存APIは無効なリクエストを拒否する {  // 第2階層: @Nested クラス
        @Test
        void ファイル未指定の場合は400を返す() {  // 第3階層: @Test メソッド（第4階層なし）
            // テスト実装
        }
    }
}
```

**命名規則:**
- クラス名・メソッド名として使えない文字（括弧、記号など）は適宜変換する
- 第3階層は、配下に第4階層がある場合は`@Nested`クラス、ない場合は`@Test`メソッドとする
- テストの意図がコードから直接読み取れるよう、日本語名をそのまま使用する

---

## Progress Tracking

実装を進める際:
1. 最も簡単なテストから始める (通常は正常系の最もシンプルなケース)
2. 完了したら項目を`[x]` に、未完了は `[ ]` のままにする
3. 実装中に気づいた新しいケースを追加する
4. リファクタリングが必要になったら別項目として追加する

**進捗表示の例:**
```
* Photo API
  * [ ] 保存APIは画像を受け取り永続化する
    * [x] 有効な画像を受け取ると201を返す（メタデータを含む）
      * [x] sample-001.jpgを受け取ると201を返す
    * [ ] ファイルが永続化される
      * [ ] sample-001.jpgを受け取るとuploaded_files/sample-001.jpgに保存される
  * [ ] 保存APIは無効なリクエストを拒否する
    * [x] ファイル未指定の場合は400を返す
    * [ ] サイズ制限超過の場合は413を返す ← 現在実装中
    * [ ] 非対応フォーマットの場合は415を返す
```

---

## References
- Gherkin Feature: `docs/spec/features/{feature_id}.md`
- Implementation Plan: `docs/plans/{feature_id}.md`
- TDD Prompt: `docs/ai/prompts/tasks/03b_implement_backend_tdd.md`
