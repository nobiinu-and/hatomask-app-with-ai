# Task00: マイルストーン指定 アーキテクチャ設計（ざっくり）

このプロンプトは、**人間が指定したマイルストーン**で対象とする複数 feature を見回した上で、実装に入る前に「全体のアーキテクチャ設計（荒め）」を作るためのものです。

> 制約: ここでは **コード実装やファイル編集はしない**。成果物（Markdown）だけを作る。

---

## 0.5 入力パラメータ（人間が指定）

このタスクを始める前に、人間が次を指定してください。

- `MILESTONE_ID`: 例 `milestone0` / `milestone1`
- `MILESTONE_SCOPE`: そのマイルストーンで対象とする feature / 非対象（roadmap 等から）

以降の本文では、`{MILESTONE_ID}` を上記の値で置換して読み進めてください。

---

## 1. 事前に読むべきもの（必須）

以下を読み、前提と制約を把握してから設計してください。

- `copilot-instructions.md`
- `docs/AI_COLLABORATION.md`
- `docs/spec/product/roadmap.md`（対象マイルストーンの範囲確認）
- 対象マイルストーンの feature 仕様
  - feature 仕様は `docs/spec/features/`にあります

データ取り扱いの前提（実在写真の扱い等）は必ず遵守すること。

---

## 2. ゴール（このタスクの出力）

次のファイルを作る想定で、内容（Markdown）を提示してください（※本タスクではファイル作成はしない）。

- 成果物: `docs/spec/architecture/{MILESTONE_ID}.md`

---

## 3. 設計スコープ

### 対象（指定マイルストーン）

- 人間が指定した `MILESTONE_SCOPE` に従う（roadmap 等の記述を優先）
- feature 単位の参照は `docs/spec/features/` 配下の該当ファイルを列挙する

### 非対象（明記）

- 人間が指定した `MILESTONE_SCOPE` に従う（「やらないこと」を明確に列挙）

---

## 4. 成果物のフォーマット（`docs/spec/architecture/{MILESTONE_ID}.md`）

以下の見出し構成に沿って、過不足なく埋めてください。

### 4.1 目的 / 非目的

- 目的（当該マイルストーンの価値）
- 非目的（やらないこと）

### 4.2 重要な前提・制約

- データ取扱（TTL、非永続化、非ログ、ダミー画像での検証方針 等）
- ブラウザ対応方針
- 性能/UX 目標（例: Time to first result など）※数値は仮で OK、根拠も添える

### 4.3 全体アーキテクチャ（俯瞰）

- 構成要素（Frontend / Backend / DB / Object Storage 相当 / 画像処理 / 3D 描画）
- 依存関係と責務の境界（Clean Architecture との整合）

Mermaid 図を 1〜2 個で示す（例: コンポーネント図・データフロー図）。

### 4.4 主要なデータフロー

- 「アップロード → 検出 → 合成 → プレビュー → 調整 → 保存」
- どの処理をクライアントでやるか / サーバでやるか（当該マイルストーンの仮決め）

### 4.5 API 方針（契約の方向性）

- 想定エンドポイント（例: アップロード、処理開始、処理結果取得 など）
- リクエスト/レスポンスの概略（厳密な OpenAPI は Task03 で良い）
- エラーハンドリング（Problem Details 準拠）

### 4.6 ドメインの荒いモデル

- Entity / ValueObject 候補（例: Photo、FaceDetectionResult、MaskTransform、RenderedImage など）
- Repository Interface 候補（永続化しない場合でも「境界」として）

### 4.7 画像・中間生成物の扱い

- 中間データ（base64、ランドマーク、特徴量など）の寿命と保存先
- ログに載せないための具体策（例: リクエストログ無効化方針 等）

### 4.8 未決事項 / リスク

- 技術リスク（Face 検出精度、3D 合成、パフォーマンス等）
- 未決事項（どこまでをサーバ処理に寄せるか 等）
- 早期検証（スパイク）提案（必要なら）

---

## 5. 作業の進め方（AI の振る舞い）

- まず「当該マイルストーンの対象機能の一覧」と「共通の概念」を短く整理する
- 次に、2〜3 案のアーキテクチャ分割（例: クライアント中心 / サーバ中心 / ハイブリッド）を出す
- その上で **推奨案を 1 つ** 選び、理由とトレードオフを書く
- 最後に、上のフォーマットに従い `docs/spec/architecture/{MILESTONE_ID}.md` の本文を完成させる

---

## 6. 出力ルール

- 余計な機能の提案や過剰設計をしない（当該マイルストーンの範囲に収める）
- 断定しすぎない（不確実な点は仮置き/未決として扱う）
- ファイルパスは上記の成果物パスを使用する
