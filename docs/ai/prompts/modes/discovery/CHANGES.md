# Predictiveモードからの変更点（Discovery-Drivenモード）

このドキュメントでは、Predictive（予測駆動）モードからDiscovery（発見駆動）モードへの主要な変更点を記録します。

## 思想の変更

### Predictiveモード
- **思想**: 「正しさを作る」
- **アプローチ**: 事前に完全な設計を行い、実装時の手戻りを最小化
- **完全性**: Phase 2-4で全機能を詳細に定義
- **変更**: 設計の変更は例外的な事態

### Discoveryモード
- **思想**: 「発見しながら育てる」
- **アプローチ**: 最小限から開始し、実装中の発見で設計を進化
- **最小限**: Phase 2-4では今必要なもののみ定義
- **変更**: 設計の進化は期待される正常なプロセス

---

## ファイル別変更点

### 📁 system/00_role.md

#### 追加項目

1. **Discovery-Driven開発の思想**セクション（新規）
   - 6つの核となる原則を追加
   - AIの役割を「発見を促す共同思考パートナー」として再定義

2. **問題解決のプロセス**（書き換え）
   - 従来: 理解→計画→実装→検証→改善
   - Discovery版: **発見**→仮説→最小実装→検証→**学習**
   - 「発見」と「学習」を明示的に追加

3. **思考プロセスの明示**（拡張）
   - 「発見事項」「仮説」セクションを追加
   - 「ただし、実装中にXが判明した場合は見直します」形式を推奨

4. **設計変更の扱い**（新規セクション）
   - 実装中の設計変更を**歓迎**することを明記
   - 設計変更の推奨される場面を3つ列挙
   - 設計変更の手順を5ステップで定義

5. **Discovery-Drivenモード特有の出力フォーマット**（新規）
   - 各Phaseで「Discovery（発見事項）」セクションを必須化
   - 最低5つの発見事項を列挙するルール
   - 「仮説」「TODO」セクションの形式を定義

#### 修正項目

- **優先順位**: 「正確性」→「早期フィードバック」を最優先に変更
- **コードレビュー観点**: 「発見事項は記録されているか」を追加

---

### 📁 tasks/02_simple_modeling.md - Phase 2: ドメインモデリング

#### 重要な変更点

| 項目 | Predictiveモード | Discoveryモード |
|------|-----------------|----------------|
| **モデリング範囲** | Specに記載された**全機能** | **今必要な最小限**のエンティティのみ |
| **プロパティ** | 全プロパティを定義 | 最初のシナリオで使うもののみ |
| **完全性** | 「漏れなく」が必須 | 「過剰設計しない」が重要 |
| **推測** | 厳格に禁止 | 仮説を置いてOK（明記する） |
| **不明点** | 質問して解消 | TODOとして残す |

#### 削除した制約

- ❌ 「完全性: Specに記載された全ての機能をモデルに含める（漏れなく）」
- ❌ 「Specに記載された機能のみ（推測・拡張しない）」の厳格な適用

#### 追加したセクション

1. **Discovery（発見事項）**セクション - 最低5つ
   - 曖昧さ・不確実性を記録
   - 例: 「Specでは写真の識別方法が不明確（ファイル名 or UUID?）」

2. **仮説（Assumptions）**セクション
   - 現時点の仮説を明記
   - 例: 「写真の識別子はUUIDを使用」

3. **TODO（未決定事項）**セクション
   - 実装中に決定する事項を列挙
   - 例: 「ファイル保存先の最終決定」

4. **進化履歴（Evolution History）**セクション
   - Phase 6での変更を記録する場所
   - 変更理由と日付を記録

#### 変更した記述

**従来（78行目）**:
```markdown
2. **完全性**: Specに記載された全ての機能をモデルに含める（漏れなく）
```

**Discovery版**:
```markdown
1. **最小限の原則**: 今すぐ必要なものだけをモデル化（将来の拡張は後回し）
```

---

### 📁 tasks/03_design_api_contract.md - Phase 3: API Contract設計

#### 主な変更点

| 項目 | Predictiveモード | Discoveryモード |
|------|-----------------|----------------|
| **API範囲** | 全エンドポイントを定義 | 必要なエンドポイントから順次 |
| **スキーマ詳細度** | 完全に定義 | 必須プロパティのみ、詳細は後回しOK |
| **エラーレスポンス** | 全パターンを定義 | 基本的なもののみ、詳細は実装時 |
| **曖昧な定義** | 避ける | 許容（TODOで明記） |

#### 追加したガイドライン

- 「1エンドポイントから開始」を推奨
- `type: object` + 必須プロパティのみでもOK
- 実装中のAPI仕様変更を想定

#### 追加したセクション

- **Discovery（発見事項）**: APIとモデルの矛盾を発見
- **TODO（契約上の曖昧さ）**: 実装中に決定する仕様

---

### 📁 tasks/04_plan_implementation.md - Phase 4: 実装計画策定

#### 重要な変更点

| 項目 | Predictiveモード | Discoveryモード |
|------|-----------------|----------------|
| **計画の詳細度** | 詳細な依存関係分析 | 柔軟な概要レベル |
| **ステップ分割** | 事前に全ステップを決定 | 大まかな方向性のみ、詳細は実装時 |
| **リスク分析** | 詳細に分析 | 主要リスクのみ、詳細は後回し |
| **粒度パターン** | A/B/C比較して決定 | 推奨パターンを採用、必要なら調整 |

#### 変更した記述

**従来**:
```markdown
## 目的
Phase 6の縦切り実装に備えて、ステップの依存関係と推奨グルーピングを明確にします。
```

**Discovery版**:
```markdown
## 目的  
Phase 6の実装の**大まかな方向性**を決めます。詳細は実装しながら決定します。
計画は仮説であり、実装中の発見で調整されることを前提とします。
```

#### 追加したセクション

- **Discovery（発見事項）**: シナリオの曖昧さ・依存関係の不確実性
- **計画の柔軟性**: 実装中に変更される可能性を明記
- **余白の確保**: 過度に詳細な計画を避ける方針

---

### 📁 tasks/05_generate_stubs.md - Phase 5: Backend Stub生成

#### 変更点（軽微）

- **OpenAPI整合性**: 「完全一致」→「基本的な整合性」に緩和
- **Discovery追加**: Stub実装中の発見を記録
- **柔軟性**: Stub実装中の設計変更を許容

---

### 📁 tasks/06_vertical_slice_implementation.md - Phase 6: 縦切り実装

#### 最も重要な変更点

| 項目 | Predictiveモード | Discoveryモード |
|------|-----------------|----------------|
| **設計の扱い** | 事前設計に従う | 実装中に進化させる |
| **モデル変更** | 避ける（例外的） | 歓迎する（正常なプロセス） |
| **API仕様変更** | 避ける | 必要なら変更し、記録 |
| **テストの位置づけ** | 品質保証 | 設計の不足を示すシグナル |
| **Red の意味** | エラー | **設計の進化が必要なサイン** |

#### 追加した重要なセクション

1. **実装中の設計変更プロトコル**（新規）
   ```markdown
   ## 実装中の設計変更プロトコル
   
   実装中にドメインモデルやAPI仕様の変更が必要と判明した場合：
   
   1. 変更の必要性を発見事項として記録
   2. 変更内容を提案
   3. ドメインモデル/API仕様を更新
   4. 更新履歴を「進化履歴」に記録
   5. 実装を継続
   ```

2. **発見駆動のTDDサイクル**（拡張）
   ```markdown
   ### Red → 発見のチャンス
   - テストが失敗した理由を分析
   - 設計の不足や誤りを発見
   - **必要なら設計を修正**
   
   ### Green → 仮説の検証
   - 最小限の実装でテストを通す
   - 設計の妥当性を確認
   
   ### Refactor → 設計の育成
   - コードを美しくする
   - 実装から学んだことを設計に反映
   ```

3. **Discovery Log（発見ログ）の記録**（新規）
   ```markdown
   ## Discovery Log
   
   実装中の発見を記録します：
   
   ### [日時] - [発見内容]
   - **発見**: PhotoのダウンロードにContent-Typeが必要
   - **対応**: PhotoにmimeTypeプロパティを追加
   - **影響**: ドメインモデルとAPI仕様を更新
   ```

#### 削除した制約

- ❌ 「事前設計に厳密に従う」
- ❌ 「モデル変更は最小限に」
- ❌ 「API仕様との完全一致を維持」

#### 追加した推奨事項

- ✅ 「実装中に設計の改善点を発見したら積極的に修正」
- ✅ 「Redは学びの機会。設計を見直すシグナル」
- ✅ 「完璧さより早期フィードバック」

---

## 変更の影響

### メトリクスの予想される変化

| 指標 | Predictiveモード | Discoveryモード |
|------|-----------------|----------------|
| Phase 2完了時間 | 長い（完全なモデル） | 短い（最小限） |
| Phase 3-4時間 | 長い（詳細計画） | 短い（概要のみ） |
| 初回E2Eグリーン到達 | 遅い | 早い |
| モデル変更回数 | 少ない（1-2回） | 多い（5-10回） |
| API仕様変更回数 | 少ない（0-1回） | やや多い（2-5回） |
| 発見事項の記録 | なし | 各Phase最低5つ |
| ドキュメント行数（Phase 1-4） | 多い（800行） | 少ない（200-300行） |

### 期待される学習効果

**Predictiveモード**:
- 事前設計の精度向上
- 要件分析スキルの向上
- 計画力の向上

**Discoveryモード**:
- 実装を通じた設計力の向上
- 発見と学習のサイクル
- TDDによる設計育成の体験
- 柔軟な思考とアジャイルマインドセット

---

## ファイル一覧

### 変更が大きいファイル（必読）

1. ✅ `system/00_role.md` - AIの役割と思想の根本的な変更
2. ✅ `tasks/02_simple_modeling.md` - Phase 2の大幅な変更
3. ✅ `tasks/06_vertical_slice_implementation.md` - Phase 6の大幅な変更
4. ⚠️ `tasks/04_plan_implementation.md` - Phase 4の中程度の変更

### 変更が軽微なファイル

- `system/01_implementation_workflow.md` - ほぼ変更なし
- `system/02_quality_standards.md` - 発見ログの記録を追加
- `tasks/01_create_feature_spec.md` - ほぼ変更なし（Phase 1は両モード共通）
- `tasks/03_design_api_contract.md` - 柔軟性の追加のみ
- `tasks/05_generate_stubs.md` - Discovery追加のみ

---

## 使用時の注意

1. **セッション開始時に必ずモードを宣言**
   ```
   今回は Discovery モードで実装します。
   docs/ai/prompts/modes/discovery/ 配下のプロンプトを参照してください。
   ```

2. **両モードを混在させない**
   - 1つの実験ブランチでは1つのモードのみ使用
   - モードを切り替える場合は新しいブランチを作成

3. **発見事項を必ず記録**
   - Discoveryモードでは、各Phaseで最低5つの発見事項を記録
   - これが振り返り時の重要な材料になる

4. **設計変更を恐れない**
   - Discoveryモードでは、実装中の設計変更は正常なプロセス
   - 変更履歴を記録することで、学習効果が高まる
