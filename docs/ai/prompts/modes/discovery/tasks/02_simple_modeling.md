---
description: 機能仕様書(Spec)から最小限のドメインモデルを作成し、発見を通じて進化させる（Discovery-Drivenモード）
---

# 簡単にモデリング（Discovery-Drivenモード）

## 依頼内容
以下の機能仕様書(Spec)を基に、**今すぐ実装に必要な最小限のドメインモデル**を作成してください。

このPhaseでは「完璧なモデル」ではなく、「実装を開始できる仮説モデル」を作成します。

## 入力情報
- **Specファイル**: `[Specファイルのパス]`
- **テンプレート**: `docs/spec/templates/domain-model.template.md`

## Discovery-Drivenモードの重要な違い

### ❌ Predictiveモード（従来）
- Specに記載された**全機能を完全にモデル化**
- 推測・拡張を厳格に禁止
- 完全性を重視

### ✅ Discoveryモード（このタスク）
- **今必要な最小限のエンティティのみ**をモデル化
- 不明な点は仮説を置き、実装中に発見
- 曖昧さをTODOとして残すことを許容
- Phase 6で設計が進化することを前提とする

## 最小限モデリングの指針

### 1. 今必要なエンティティのみ

最初に実装するシナリオ（通常はPhase 4で決定）に**今すぐ必要な**エンティティのみを定義します。

例: 「写真アップロード・ダウンロード機能」で最初に「JPEGアップロード」を実装する場合：
- ✅ Photo（写真エンティティ）- 必須
- ✅ PhotoId（識別子）- 必須
- ❓ PhotoMetadata（メタデータ）- 必要かどうか実装中に判断（TBD）
- ❌ User（ユーザー）- 後のシナリオで必要になったら追加
- ❌ Album（アルバム）- スコープ外
- ❌ Tag（タグ）- スコープ外

### 2. プロパティは最小限

エンティティのプロパティは、最初のシナリオで**実際に使うもののみ**を定義します。

```markdown
## Photo（写真エンティティ）

- id: string (UUID) - 必須、一意な識別子
- filePath: string - 必須、サーバー上のファイルパス
- uploadedAt: DateTime - 必須、アップロード日時

<!-- 以下は実装中に必要になったら追加 -->
<!-- TBD: mimeType, fileSize, originalFileName など -->
```

### 3. 仮説を明示する

不明な点は「仮説」として明記し、実装中に検証します。

```markdown
## 仮説（Assumptions）

現時点では以下の仮説で進めます：

1. 写真の識別子はUUIDを使用（ファイル名ではなく）
2. ファイルは `/uploads/{uuid}.jpg` に保存
3. メタデータ（EXIF等）の抽出は後のフェーズで検討
4. マルチパート形式でアップロード

実装中にこれらの仮説を検証し、必要なら修正します。
```

### 4. TODOを残す

決定を後回しにして良い事項は、明示的にTODOとして残します。

```markdown
## TODO（未決定事項）

以下は実装中に決定します：

- [ ] ファイルの保存先（ローカルストレージ / S3 など）
- [ ] サムネイル生成の要否
- [ ] ファイルサイズ制限の具体的な値
- [ ] サポートする画像形式（JPEG以外）
```

## 出力形式

### 1. テンプレートの使用
`docs/spec/templates/domain-model.template.md` をベースにドメインモデルを作成してください。

### 2. 保存先
`docs/spec/models/{feature_name}.md`

例: `docs/spec/models/photo_upload_download.md`

### 3. モデリング要素

テンプレートの各セクションに従い、以下の要素を記述してください。

#### エンティティ (Entity)
ライフサイクルを持ち、一意に識別される必要があるオブジェクト。

**記述ポイント（Discovery版）**:
- 説明: エンティティの役割を明確に
- プロパティ: **今必要な**プロパティのみ。後で追加するものはコメントで記載
- バリデーションルール: **確定している**ルールのみ。不明な点は仮説として記載
- 関連: 確定している関係のみ

#### バリューオブジェクト (Value Object)
値そのものを表現し、同一性ではなく値の等価性で比較されるオブジェクト（不変）。

**記述ポイント（Discovery版）**:
- 説明: 値の意味と責務
- プロパティ: 最小限の値
- バリデーションルール: 確定しているチェックのみ
- **不要なら定義をスキップ可**（実装中に必要になったら追加）

#### リポジトリインターフェース (Repository Interface)
エンティティの永続化と取得を抽象化するインターフェース。

**記述ポイント（Discovery版）**:
- 説明: 対象エンティティと責務
- メソッド: **最初のシナリオで使うメソッドのみ**（例: `save()` のみ、`findById()` は後で追加）

#### ドメインサービス (Domain Service)
複数のエンティティにまたがるロジックや、エンティティに属さないドメインロジック（必要な場合のみ）。

**記述ポイント（Discovery版）**:
- 説明: サービスの目的
- メソッド: 提供する操作
- **不要なら最初はスキップ可**（実装中に複雑なロジックが出現したら追加）

## Discovery-Driven特有のセクション

ドメインモデルドキュメントに以下のセクションを追加してください：

### Discovery（発見事項）

モデリング中に発見した曖昧さ・不確実性を記録します（最低5つ）：

```markdown
## Discovery（発見事項）

以下の曖昧さ・不確実性を発見しました：

1. [発見1]: Specでは写真の識別方法が不明確（ファイル名 or UUID?）
2. [発見2]: ファイルの保存先が未定義（ローカル or クラウド?）
3. [発見3]: メタデータ（EXIF）の扱いが不明
4. [発見4]: エラー時の挙動（ロールバック戦略）が未定義
5. [発見5]: 同時アップロードの制御が未考慮
```

### 仮説（Assumptions）

現時点の仮説を明記します：

```markdown
## 仮説（Assumptions）

現時点では以下の仮説で進めます：

- 仮説1: 写真の識別子はUUIDを使用
- 仮説2: ファイルはローカルの `/uploads/` に保存
- 仮説3: メタデータ抽出は最初のリリースでは不要

実装中に検証し、必要なら修正します。
```

### TODO（未決定事項）

実装中に決定すべき事項を列挙します：

```markdown
## TODO（未決定事項）

実装中に決定します：

- [ ] ファイル保存先の最終決定
- [ ] サムネイル生成の要否と方式
- [ ] ファイルサイズ制限の具体的な値（Specでは「適切なサイズ制限」のみ）
- [ ] サポートする画像形式の詳細リスト
```

### 進化履歴（Evolution History）

実装中にモデルが変更された場合、履歴を記録します（Phase 6以降）：

```markdown
## 進化履歴（Evolution History）

### 2025-12-15: PhotoMetadata追加
- 理由: 実装中に、ダウンロード時にContent-Typeが必要と判明
- 変更: PhotoにmimeTypeプロパティを追加

### 2025-12-16: PhotoRepository.findById()追加
- 理由: ダウンロード実装でID検索が必要と判明
- 変更: リポジトリにfindByIdメソッドを追加
```

## 制約事項（Discovery版）

1. **最小限の原則**: 今すぐ必要なものだけをモデル化（将来の拡張は後回し）
2. **仮説の明示**: 不明な点は仮説を置き、明記する
3. **TODOの活用**: 決定を後回しにする事項は明示的にTODOとして残す
4. **進化前提**: Phase 6で変更されることを前提とし、柔軟に対応
5. **シンプルさ**: 過度に複雑なモデリングは避ける

## 実装手順

1. **テンプレート取得**: `docs/spec/templates/domain-model.template.md` を参照
2. **Spec分析**: 機能仕様書を読み、**最初のシナリオ**を想定
3. **Discovery**: 曖昧さ・不確実性を最低5つ発見し、記録
4. **最小モデル作成**: 今必要な要素のみを含むモデルを作成
5. **仮説・TODO記載**: 不明点を明示

## チェックリスト

モデリング完了前に確認:
- [ ] **最小限の原則**: 今必要な要素のみが含まれている（過剰設計していない）
- [ ] **Discovery記載**: 曖昧さを最低5つ発見し、記録した
- [ ] **仮説の明示**: 不明な点を仮説として明記した
- [ ] **TODO記載**: 後で決定する事項を明示した
- [ ] **進化履歴セクション**: Phase 6での変更記録用セクションを用意した

## 次のステップ

このモデリング成果物は、次のフェーズで使用・進化されます:

- **Phase 3: API Contract設計 + ドメインモデル見直し（1回目）** 
  - API仕様とモデルの整合性を確認
  - 矛盾があればモデルを修正（これは正常なプロセス）
  
- **Phase 4: Gherkinシナリオ作成 + 実装計画策定** 
  - このモデルを参照して計画立案
  - 計画中に新たな発見があればモデルを更新可
  
- **Phase 6: 縦切り実装サイクル（2回目以降の見直し）** 
  - 実装中に発見したことでモデルを進化
  - 変更は「進化履歴」に記録
  
**重要**: このモデルは「仮説」です。Phase 3, 6で変更されることを期待しています。変更を恐れず、実装を通じて学びましょう。
